+++
title = "GoGoPi 小车 - 自动巡线"
description = "记录完成 GoGoPi 小车的自动巡线程序的过程"
date = "2023-05-29"
draft = true 

[taxonomies]
    categories = ["record"]
    tags = ["GoGoPi"]
+++

## 前情提要

根据学校的课程安排，使用 GoGoPi 小车，在提供手势或者颜色识别作为小车的起始信号后，小车沿着当前地面的标线自动行驶，在不出现左右轮超过地面标线的情况下绕行一圈，绕行完成后识别到起始线并在越线之后自动停止。

## 开发方式 

由于当前所使用的 GoGoPi 小车，有且仅提供了一种方法实现链接，即通过电脑连接到小车的局域网。然后再通过`VNC-Viewer`等程序连接到对应的可视化程序中进行开发，但是开发的过程中没有办法链接到互联网，同时也较难使用现有的开发环境对其进行开发。*（由于不存在互联网连接，因此基本上只能通过`sshfs`或者`vim`远程登录过去，无法使用`vscode`或者其他的软件来开发）*

下面简单介绍一些可以使用的方法

### 连接上之后的开发方式

1. 通过 vim 远程进行开发
    - 需要你具有一定的 vim 使用基础
    - 开发效果不佳，而且需要而外设置对应的库位置，否则代码中使用的引入都没法正常识别。*笔者这边使用的语法插件不支持添加库，因此不做说明*
2. 通过 sshfs 将远程仓库挂在到当前系统，然后再进行开发

- 首先在你当前的系统中安装 sshfs 服务 *在未连接小车的情况下*。
- 通过连接到小车的局域网，连接到小车
    - 可以通过 `ssh pi@192.168.149.1` 测试当前能否连接到小车
    - 可以通过 `ssh-copy-id pi@192.168.149.1` 将当前计算机的 ssh 秘钥拷贝到小车上，这样在终端中连接的时候就不用输密码。
- *我建议可以运行 `mkdir ~/mnt` 在当前用户下创建一个挂载文件夹，这样可以使之后对于挂载文件夹内文件的操作不需要升权*
- 运行下列代码以将小车的 Pi 用户目录挂载到 `~/mnt` 文件夹

```bash
sshfs -odebug,sshfs_debug,loglevel=debug pi@192.168.149.1:/home/pi/ ~/mnt
```

- 如果出现下列情况，可以采用 `sudo chmod 700 ~/.ssh` 后运行 `sudo chmod 600 ~/.ssh` 来解决此问题。

```plain
SSHFS version 3.7.3
executing <ssh> <-x> <-a> <-oClearAllForwardings=yes> <-ologlevel=debug> <-2> <pi@192.168.149.1> <-s> <sftp>
Bad owner or permissions on /home/jacky/.ssh/config
read: Connection reset by peer 
```

- 然后可以直接通过本地编辑器打开 `~/mnt` 下的文件进行开发，对于文件的修改会即时反应到小车的文件系统中，但是在运行程序的时候需要通过 ssh 连接到小车之后在终端中运行的。 

### 连接方式 

1. 使用笔记本连接到小车所发出的局域网
2. 可以尝试通过树莓派上的串口进行通信 *由于树莓派的串口通信接口被辅助板占用，因此没有办法使用*。
3. 可以尝试通过公网连接到小车

- 首先还得通过 ssh 连接到目标小车中，在小车上插入网线接口，尝试能否在小车中连入外网，比如说 `ping baidu.com`。
- 尝试创建一个 `zerotier` 账号，并且创建一个内部网络连接。
- 更新树莓派的库 `sudo apt update && sudo apt upgrade`。
- 按照[树莓派安装教程](https://www.cnblogs.com/guyk/p/8911780.html)，在树莓派上安装 zerotier 软件。
- 并通过 `zerotier join NETWORKID` 加入到对应网络中（包括本机和树莓派）。
- 根据 zerotier 网络上的内网映射地址，尝试通过 ssh 进行连接。

> 之后就可以正常在连接网络的情况下对于小车进行操作了，包括但不限于通过 git 管理代码仓库等行为
